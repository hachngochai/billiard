{"version":3,"sources":["main.js"],"names":["console","clear","noise","seed","Math","random","ASSET_PREFIX","PI","PI2","Bodies","Matter","Body","Composite","Constraint","Engine","Events","Mouse","MouseConstraint","Render","Vector","World","COLORS","white","red","black","purple","blue","green","yellow","orange","brown","felt","pocket","frame","WIREFRAMES","INCH","FOOT","BALL_DI","BALL_RAD","POCKET_DI","POCKET_RAD","WALL_DI","WALL_RAD","TABLE_W","TABLE_H","RETURN_H","VIEW_W","VIEW_H","Ball","number","cueball","cue","eight","stripes","solids","diameter","pocketed","setInitialCoordinates","setRender","setColor","build","pos","positions","map","p","rel","x","y","color","render","fillStyle","lineWidth","setStatic","body","isSensor","setVelocity","setPosition","position","update","enable","disable","setAngle","circle","label","restitution","friction","density","angle","radians60","radians60Sin","sin","radians60Cos","cos","postStartX","postStartY","pos1","pos2","pos3","pos4","pos5","Table","width","height","hypot","buildBounds","buildWall","buildPockets","boundsOptions","isStatic","hw","vw","h","bounds","rectangle","wallOptions","slop","quarterW","halfH","vertices","wallVertices","horizontalBlock","verticalBlock","middleBlock","horTY","horBY","horLX","horRX","verTY","verBY","verLX","verRX","walls","fromVertices","bottom","top","left","right","pocketOptions","pocketTopY","pocketBottomY","pocketLeftX","pocketRightX","pockets","obj","Machine","clock","fireCount","placingCueball","power","shouldFire","n1","perlin2","n2","n3","max","min","Player","points","count","nameText","txt","denomText","Canvas","context","beginPath","arc","fill","rad","strokeStyle","translate","rotate","stroke","moveTo","lineTo","wallBodies","pocketBodies","drawSlate","drawWall","drawReturn","drawPockets","drawPoints","grad","createRadialGradient","addColorStop","fillRect","gutter","forEach","i","j","save","clip","clipOff","clipDiff","restore","circleRadius","di","inc","xc1","xl1","xr1","xc2","xl2","xr2","x3","x4","y1","y2","yc3","yt3","yb3","coords","maxDistance","cueX","cueY","atan2","angleCos","angleSin","lineMinX","lineMinY","lineMaxX","lineMaxY","newX","newY","forceX","forceY","lineCap","closePath","balls","ballIds","inAngle","len","length","ballId","ball","drawBall","a","offsetX","offsetY","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","s1","e1","s2","e2","Game","world","canvas","sounds","machine","$score","document","querySelector","$message","table","ballNumbers","cueId","id","eightId","push","addBodiesToWorld","initEscapedBodiesRetrieval","reset","log","gameOver","mousedown","powerStep","powerDirection","players","playersAssigned","currentPlayerIdx","messages","currentPlayer","turnText","pocketedThisTurn","pocketedStripes","pocketedSolids","updateDOM","add","b","moving","placeCueball","strikeCueball","setupCueball","handlePocketedBall","tickPower","wasMoving","checkMovement","isMoving","handleTurnEnd","movingCrosshair","drawTable","drawBalls","isMachineClick","isMachine","fire","tick","handleMousedown","moveCueball","drawIndicator","handleMouseup","drawMovingCrosshair","drawCrosshair","pairs","bodyA","bodyB","coll","distance","handlePocketed","collision","speed","axisBody","firstContact","vol","rate","volume","play","rail","restBalls","winner","isCue","filter","isEight","validFirstContact","hasStripes","hasSolids","assign","otherPlayer","score","messageEight","onEight","messageScratch","switchTurns","messageInvalidContact","messageWin","handleGameOver","messageTurn","aMachineBall","$button","createElement","innerHTML","addEventListener","remove","appendChild","scratchText","invalidContactText","eightText","winText","rest","applyForce","maxX","minX","maxY","minY","current","updatePlayerDOM","m","join","player","eightball","floor","create","gravity","engine","timing","timeScale","element","options","wireframes","background","window","location","href","match","classList","src","img","Image","mouse","Howl","game","on","handleTickAfter","constraint","e","handleCollisionActive","handleCollisionStart","run","allBodies","hasBodyEscaped","setInterval","handleEscapedBall"],"mappings":"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","sourcesContent":["console.clear();\r\n\r\nnoise.seed(Math.random() * 1000);\r\n\r\nconst ASSET_PREFIX = 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/111863/';\r\n\r\nconst PI = Math.PI,\r\nPI2 = PI * 2;\r\n\r\nconst // module aliases\r\nBodies = Matter.Bodies,\r\nBody = Matter.Body,\r\nComposite = Matter.Composite,\r\nConstraint = Matter.Constraint,\r\nEngine = Matter.Engine,\r\nEvents = Matter.Events,\r\nMouse = Matter.Mouse,\r\nMouseConstraint = Matter.MouseConstraint,\r\nRender = Matter.Render,\r\nVector = Matter.Vector,\r\nWorld = Matter.World;\r\n\r\nconst COLORS = {\r\n  white: 'white',\r\n  red: '#F44336',\r\n  black: '#212121',\r\n  purple: '#9C27B0',\r\n  blue: '#2196F3',\r\n  green: '#8bc34a',\r\n  yellow: '#FFC107',\r\n  orange: '#FF9800',\r\n  brown: '#795548',\r\n  felt: '#757575',\r\n  pocket: '#121212',\r\n  frame: '#3E2723' };\r\n\r\n\r\nconst WIREFRAMES = false,\r\nINCH = 12,\r\nFOOT = INCH * 12,\r\nBALL_DI = 2.4375 * INCH,\r\nBALL_RAD = BALL_DI / 2,\r\n// POCKET_DI = 3.5 * INCH,\r\nPOCKET_DI = 4.5 * INCH,\r\nPOCKET_RAD = POCKET_DI / 2,\r\nWALL_DI = 5 * INCH,\r\nWALL_RAD = WALL_DI / 2,\r\n// TABLE_W = 9 * FOOT,\r\nTABLE_W = 8 * FOOT,\r\n// TABLE_H = 4.5 * FOOT,\r\nTABLE_H = 3.5 * FOOT,\r\nRETURN_H = BALL_DI * 1.75,\r\nVIEW_W = WALL_DI * 2 + TABLE_W,\r\nVIEW_H = WALL_DI * 2 + TABLE_H + RETURN_H;\r\n\r\nclass Ball {\r\n  constructor({ number, cueball }) {\r\n    this.cue = number === 0;\r\n    this.eight = number === 8;\r\n    this.stripes = number > 8;\r\n    this.solids = number > 0 && number < 8;\r\n    this.number = number;\r\n    this.diameter = BALL_DI;\r\n    this.pocketed = false;\r\n    this.setInitialCoordinates();\r\n    this.setRender();\r\n    this.setColor();\r\n    this.cueball = cueball;\r\n    this.build();\r\n  }\r\n\r\n  get fromCueball() {\r\n    return {\r\n      angle: Vector.angle(this.body.position, this.cueball.body.position) };\r\n\r\n  }\r\n\r\n  setInitialCoordinates() {\r\n    let pos = Ball.positions[this.number].map(p => rel(p));\r\n    this.x = pos[0];\r\n    this.y = pos[1];\r\n  }\r\n\r\n  setColor() {\r\n    this.color = COLORS[[\r\n    'white',\r\n    'yellow', 'blue', 'red', 'purple', 'orange', 'green', 'brown',\r\n    'black',\r\n    'yellow', 'blue', 'red', 'purple', 'orange', 'green', 'brown'][\r\n    this.number]];\r\n  }\r\n\r\n  setRender() {\r\n    this.render = { fillStyle: 'transparent', lineWidth: 0 };\r\n  }\r\n\r\n  enable() {\r\n    Body.setStatic(this.body, false);\r\n    this.pocketed = false;\r\n    this.body.isSensor = false;\r\n  }\r\n\r\n  disable() {\r\n    if (!this.cue) Body.setStatic(this.body, true);\r\n    this.pocketed = true;\r\n    this.body.isSensor = true;\r\n  }\r\n\r\n  rest() {\r\n    this.setVelocity({ x: 0, y: 0 });\r\n    Body.setPosition(this.body, this.body.position);\r\n    Body.update(this.body, 0, 0, 0);\r\n  }\r\n\r\n  reset() {\r\n    this.enable();\r\n    this.setVelocity({ x: 0, y: 0 });\r\n    Body.setPosition(this.body, { x: this.x, y: this.y });\r\n  }\r\n\r\n  pocket({ x, y }) {\r\n    this.disable();\r\n    Body.setVelocity(this.body, { x: 0, y: 0 });\r\n    Body.setAngle(this.body, 0);\r\n    Body.setPosition(this.body, { x, y });\r\n    Body.update(this.body, 0, 0, 0);\r\n  }\r\n\r\n  setVelocity({ x, y }) {\r\n    Body.setVelocity(this.body, { x, y });\r\n  }\r\n\r\n  build() {\r\n    this.body = Bodies.circle(\r\n    this.x, this.y,\r\n    this.diameter / 2,\r\n    {\r\n      render: this.render,\r\n      label: 'ball',\r\n      restitution: 0.9,\r\n      friction: 0.001,\r\n      density: this.cue ? 0.00021 : 0.0002 });\r\n\r\n\r\n  }\r\n\r\n  static get positions() {\r\n    let radians60 = 60 * (Math.PI / 180),\r\n    radians60Sin = Math.sin(radians60),\r\n    radians60Cos = Math.cos(radians60);\r\n\r\n    let postStartX = TABLE_W - TABLE_W / 4,\r\n    postStartY = TABLE_H / 2,\r\n    pos1 = [postStartX, postStartY],\r\n    pos2 = [postStartX + radians60Sin * BALL_DI,\r\n    postStartY - radians60Cos * BALL_DI],\r\n    pos3 = [postStartX + radians60Sin * (BALL_DI * 2),\r\n    postStartY - radians60Cos * (BALL_DI * 2)],\r\n    pos4 = [postStartX + radians60Sin * (BALL_DI * 3),\r\n    postStartY - radians60Cos * (BALL_DI * 3)],\r\n    pos5 = [postStartX + radians60Sin * (BALL_DI * 4),\r\n    postStartY - radians60Cos * (BALL_DI * 4)];\r\n    return [\r\n    [// cue\r\n    TABLE_W / 4, TABLE_H / 2],\r\n    pos1, // 1\r\n    pos2, // 2\r\n    pos3, // 3\r\n    pos4, // 4\r\n    [// 5\r\n    pos1[0] + radians60Sin * (BALL_DI * 4),\r\n    pos1[1] + radians60Cos * (BALL_DI * 4)],\r\n    [// 6\r\n    pos4[0] + radians60Sin * BALL_DI,\r\n    pos4[1] + radians60Cos * BALL_DI],\r\n    [// 7\r\n    pos2[0] + radians60Sin * BALL_DI * 2,\r\n    pos2[1] + radians60Cos * BALL_DI * 2],\r\n    [// 8\r\n    pos2[0] + radians60Sin * BALL_DI,\r\n    pos2[1] + radians60Cos * BALL_DI],\r\n    [// 9\r\n    pos1[0] + radians60Sin * BALL_DI,\r\n    pos1[1] + radians60Cos * BALL_DI],\r\n    [// 10\r\n    pos1[0] + radians60Sin * (BALL_DI * 2),\r\n    pos1[1] + radians60Cos * (BALL_DI * 2)],\r\n    [// 11\r\n    pos1[0] + radians60Sin * (BALL_DI * 3),\r\n    pos1[1] + radians60Cos * (BALL_DI * 3)],\r\n    pos5, // 12\r\n    [// 13\r\n    pos2[0] + radians60Sin * (BALL_DI * 3),\r\n    pos2[1] + radians60Cos * (BALL_DI * 3)],\r\n    [// 14\r\n    pos3[0] + radians60Sin * BALL_DI,\r\n    pos3[1] + radians60Cos * BALL_DI],\r\n    [// 15\r\n    pos3[0] + radians60Sin * (BALL_DI * 2),\r\n    pos3[1] + radians60Cos * (BALL_DI * 2)]];\r\n\r\n  }}\r\n\r\n\r\nclass Table {\r\n  constructor() {\r\n    this.width = TABLE_W;\r\n    this.height = TABLE_H;\r\n    this.hypot = Math.hypot(TABLE_W, TABLE_H);\r\n    this.build();\r\n  }\r\n\r\n  build() {\r\n    this.buildBounds();\r\n    this.buildWall();\r\n    this.buildPockets();\r\n  }\r\n\r\n  buildBounds() {\r\n    let boundsOptions = {\r\n      isStatic: true,\r\n      render: { fillStyle: 'red' },\r\n      label: 'bounds',\r\n      friction: 1,\r\n      restitution: 0,\r\n      density: 1 };\r\n\r\n    let hw = VIEW_W + VIEW_H * 2;\r\n    let vw = VIEW_H;\r\n    let h = VIEW_H;\r\n\r\n    this.bounds = [\r\n    // Top\r\n    Bodies.rectangle(VIEW_W * 0.5, h * -0.5, hw, h, boundsOptions),\r\n    // Bottom\r\n    Bodies.rectangle(VIEW_W * 0.5, VIEW_H + h * 0.5, hw, h, boundsOptions),\r\n    // Left\r\n    Bodies.rectangle(vw * -0.5, VIEW_H * 0.5, vw, h, boundsOptions),\r\n    // Left\r\n    Bodies.rectangle(VIEW_W + vw * 0.5, VIEW_H * 0.5, vw, h, boundsOptions)];\r\n\r\n  }\r\n\r\n  buildWall() {\r\n    let wallOptions = {\r\n      isStatic: true,\r\n      render: { fillStyle: 'transparent' },\r\n      label: 'wall',\r\n      friction: 0.0025,\r\n      restitution: 0.6,\r\n      density: 0.125,\r\n      slop: 0.5 };\r\n\r\n\r\n    let quarterW = (TABLE_W - POCKET_RAD * 2) / 4;\r\n    let halfH = (TABLE_H - POCKET_RAD) / 2;\r\n    let vertices = Table.wallVertices;\r\n    let horizontalBlock = { width: WALL_DI * 1.5, height: WALL_DI - POCKET_RAD };\r\n    let verticalBlock = { width: WALL_DI - POCKET_RAD, height: WALL_DI * 1.5 };\r\n    let middleBlock = { width: WALL_DI - POCKET_RAD, height: WALL_DI - POCKET_RAD };\r\n    let horTY = horizontalBlock.height / 2,\r\n    horBY = rel(TABLE_H + WALL_DI - horizontalBlock.height / 2),\r\n    horLX = horizontalBlock.width / 2,\r\n    horRX = rel(TABLE_W + WALL_DI - horizontalBlock.width / 2),\r\n    verTY = verticalBlock.height / 2,\r\n    verBY = rel(TABLE_H + WALL_DI - verticalBlock.height / 2),\r\n    verLX = verticalBlock.width / 2,\r\n    verRX = rel(TABLE_W + WALL_DI - verticalBlock.width / 2);\r\n\r\n    this.walls = [\r\n    // Bottom Left\r\n    Bodies.fromVertices(rel(TABLE_W / 4), rel(TABLE_H + WALL_RAD), vertices.bottom, wallOptions),\r\n    // Bottom Right\r\n    Bodies.fromVertices(rel(TABLE_W / 4 + TABLE_W / 2), rel(TABLE_H + WALL_RAD), vertices.bottom, wallOptions),\r\n    // Top Left\r\n    Bodies.fromVertices(rel(TABLE_W / 4), rel(0 - WALL_RAD), vertices.top, wallOptions),\r\n    // Top Right\r\n    Bodies.fromVertices(rel(TABLE_W / 4 + TABLE_W / 2), rel(0 - WALL_RAD), vertices.top, wallOptions),\r\n    // Left\r\n    Bodies.fromVertices(rel(0 - WALL_RAD), rel(TABLE_H / 2), vertices.left, wallOptions),\r\n    // Right\r\n    Bodies.fromVertices(rel(TABLE_W + WALL_RAD), rel(TABLE_H / 2), vertices.right, wallOptions),\r\n    // TL horizontal\r\n    Bodies.rectangle(horLX, horTY, horizontalBlock.width, horizontalBlock.height, wallOptions),\r\n    // TR horizontal\r\n    Bodies.rectangle(horRX, horTY, horizontalBlock.width, horizontalBlock.height, wallOptions),\r\n    // BL horizontal\r\n    Bodies.rectangle(horLX, horBY, horizontalBlock.width, horizontalBlock.height, wallOptions),\r\n    // BR horizontal\r\n    Bodies.rectangle(horRX, horBY, horizontalBlock.width, horizontalBlock.height, wallOptions),\r\n    // TL vertical\r\n    Bodies.rectangle(verLX, verTY, verticalBlock.width, verticalBlock.height, wallOptions),\r\n    // TR vertical\r\n    Bodies.rectangle(verRX, verTY, verticalBlock.width, verticalBlock.height, wallOptions),\r\n    // BL vertical\r\n    Bodies.rectangle(verLX, verBY, verticalBlock.width, verticalBlock.height, wallOptions),\r\n    // BR vertical\r\n    Bodies.rectangle(verRX, verBY, verticalBlock.width, verticalBlock.height, wallOptions),\r\n    // B middle\r\n    Bodies.rectangle(rel(TABLE_W / 2), horBY, middleBlock.width, middleBlock.height, wallOptions),\r\n    // T middle\r\n    Bodies.rectangle(rel(TABLE_W / 2), horTY, middleBlock.width, middleBlock.height, wallOptions)];\r\n\r\n  }\r\n\r\n  buildPockets() {\r\n    let pocketOptions = {\r\n      render: { fillStyle: 'transparent', lineWidth: 0 },\r\n      label: 'pocket',\r\n      isSensor: true };\r\n\r\n    let pocketTopY = WALL_DI * 0.75;\r\n    let pocketBottomY = TABLE_H + WALL_DI * 1.25;\r\n    let pocketLeftX = WALL_DI * 0.75;\r\n    let pocketRightX = TABLE_W + WALL_DI * 1.25;\r\n    this.pockets = [\r\n    Bodies.circle(pocketLeftX, pocketTopY, POCKET_RAD, pocketOptions),\r\n    Bodies.circle(TABLE_W / 2 + WALL_DI, pocketTopY, POCKET_RAD, pocketOptions),\r\n    Bodies.circle(pocketRightX, pocketTopY, POCKET_RAD, pocketOptions),\r\n    Bodies.circle(pocketLeftX, pocketBottomY, POCKET_RAD, pocketOptions),\r\n    Bodies.circle(TABLE_W / 2 + WALL_DI, pocketBottomY, POCKET_RAD, pocketOptions),\r\n    Bodies.circle(pocketRightX, pocketBottomY, POCKET_RAD, pocketOptions)];\r\n\r\n  }\r\n\r\n  static get wallVertices() {\r\n    let obj = {};\r\n    let quarterW = (TABLE_W - POCKET_RAD * 2) / 4;\r\n    let halfH = (TABLE_H - POCKET_RAD) / 2;\r\n    obj.bottom = [\r\n    { x: -quarterW, y: WALL_DI },\r\n    { x: quarterW, y: WALL_DI },\r\n    { x: quarterW, y: POCKET_RAD },\r\n    { x: quarterW - POCKET_RAD, y: 0 },\r\n    { x: -quarterW + POCKET_RAD, y: 0 },\r\n    { x: -quarterW, y: POCKET_RAD }];\r\n\r\n    obj.top = [\r\n    { x: -quarterW, y: 0 },\r\n    { x: quarterW, y: 0 },\r\n    { x: quarterW, y: WALL_DI - POCKET_RAD },\r\n    { x: quarterW - POCKET_RAD, y: WALL_DI },\r\n    { x: -quarterW + POCKET_RAD, y: WALL_DI },\r\n    { x: -quarterW, y: WALL_DI - POCKET_RAD }];\r\n\r\n    obj.left = [\r\n    { y: -halfH, x: 0 },\r\n    { y: halfH, x: 0 },\r\n    { y: halfH, x: WALL_DI - POCKET_RAD },\r\n    { y: halfH - POCKET_RAD, x: WALL_DI },\r\n    { y: -halfH + POCKET_RAD, x: WALL_DI },\r\n    { y: -halfH, x: WALL_DI - POCKET_RAD }];\r\n\r\n    obj.right = [\r\n    { y: -halfH, x: WALL_DI },\r\n    { y: halfH, x: WALL_DI },\r\n    { y: halfH, x: POCKET_RAD },\r\n    { y: halfH - POCKET_RAD, x: 0 },\r\n    { y: -halfH + POCKET_RAD, x: 0 },\r\n    { y: -halfH, x: POCKET_RAD }];\r\n\r\n    return obj;\r\n  }}\r\n\r\n\r\nclass Machine {\r\n  constructor() {\r\n    this.clock = 0;\r\n    this.fireCount = 0;\r\n    this.x = rel(TABLE_W * 0.5);\r\n    this.y = rel(TABLE_H * 0.5);\r\n  }\r\n\r\n  reset({ x, y }, placingCueball) {\r\n    if (placingCueball) {\r\n      this.x = rel(TABLE_W * 0.5);\r\n      this.y = rel(TABLE_H * 0.5);\r\n    } else {\r\n      this.x = x;\r\n      this.y = y;\r\n    }\r\n    this.power = 0;\r\n  }\r\n\r\n  fire() {\r\n    if (this.fireCount > 100) {\r\n      this.fireCount = 0;\r\n      return true;\r\n    }\r\n    let shouldFire = Math.random() < 0.0125;\r\n    if (shouldFire)\r\n    this.fireCount = 0;else\r\n\r\n    this.fireCount++;\r\n    return shouldFire;\r\n  }\r\n\r\n  tick() {\r\n    let n1 = noise.perlin2(this.clock, this.clock);\r\n    let n2 = noise.perlin2(this.clock + 100, this.clock + 100);\r\n    let n3 = noise.perlin2(this.clock + 1000, this.clock + 1000);\r\n    let max = 16;\r\n    this.x = Math.max(Math.min(this.x + n1 * max, rel(TABLE_W)), rel(0));\r\n    this.y = Math.max(Math.min(this.y + n2 * max, rel(TABLE_H)), rel(0));\r\n    this.clock += 0.02;\r\n    this.power = (n3 + 1) * 0.5 * 0.8 + 0.2;\r\n  }}\r\n\r\n\r\nclass Player {\r\n  constructor(number) {\r\n    this.number = number;\r\n    this.stripes = false;\r\n    this.solids = false;\r\n    this.points = 0;\r\n  }\r\n\r\n  get onEight() {\r\n    return this.points === 7;\r\n  }\r\n\r\n  get winner() {\r\n    return this.points === 8;\r\n  }\r\n\r\n  get denomText() {\r\n    if (this.stripes) return 'Stripes';\r\n    if (this.solids) return 'Solids';\r\n    return '';\r\n  }\r\n\r\n  get invalidContactText() {\r\n    if (this.stripes) return `${this.nameText} did not hit a Stripe first.`;\r\n    if (this.solids) return `${this.nameText} did not hit a Solid first.`;\r\n  }\r\n\r\n  get nameText() {\r\n    if (this.number === 1) return '<strong>You</strong>';\r\n    return '<strong>AI</strong>';\r\n  }\r\n\r\n  get eightText() {\r\n    return `${this.nameText} Pocketed the Eight.`;\r\n  }\r\n\r\n  get scratchText() {\r\n    return `${this.nameText} Scratched!`;\r\n  }\r\n\r\n  get turnText() {\r\n    let txt = this.number === 1 ? 'Your' : 'AI\\'s';\r\n    txt = `<strong>${txt}</strong>`;\r\n    txt += ' Turn ';\r\n    if (this.stripes || this.solids) txt += `(${this.denomText})`;\r\n    return txt;\r\n  }\r\n\r\n  get winText() {\r\n    if (this.number === 1) return '<strong>You</strong> Win!';\r\n    return '<strong>AI</strong> Wins!';\r\n  }\r\n\r\n  get teamText() {\r\n    return `${this.nameText} is ${this.denomText}`;\r\n  }\r\n\r\n  assign(stripes) {\r\n    stripes ? this.stripes = true : this.solids = true;\r\n  }\r\n\r\n  score(count) {\r\n    this.points += count;\r\n  }}\r\n\r\n\r\nclass Canvas {\r\n  constructor({ context }) {\r\n    this.context = context;\r\n  }\r\n\r\n  drawCrosshair({ x, y }) {\r\n    this.context.fillStyle = 'rgba(255, 255, 255, 0.25)';\r\n    this.context.beginPath();\r\n    this.context.arc(x, y, BALL_RAD, 0, PI2, false);\r\n    this.context.fill();\r\n  }\r\n\r\n  drawMovingCrosshair({ x, y }) {\r\n    let rad = BALL_RAD - 2;\r\n    this.context.strokeStyle = COLORS.red;\r\n    this.context.lineWidth = 4;\r\n    this.context.translate(x, y);\r\n    this.context.rotate(-PI * 0.25);\r\n    // circle\r\n    this.context.beginPath();\r\n    this.context.arc(0, 0, rad, 0, PI2, false);\r\n    this.context.stroke();\r\n    // slash\r\n    this.context.beginPath();\r\n    this.context.moveTo(0, (BALL_RAD + 2) * -0.5);\r\n    this.context.lineTo(0, (BALL_RAD + 2) * 0.5);\r\n    this.context.stroke();\r\n    // rotating back\r\n    this.context.rotate(PI * 0.25);\r\n    this.context.translate(-x, -y);\r\n\r\n  }\r\n\r\n  drawTable({ wallBodies, pocketBodies }) {\r\n    this.drawSlate();\r\n    this.drawWall(wallBodies);\r\n    this.drawReturn();\r\n    this.drawPockets(pocketBodies);\r\n    this.drawPoints();\r\n  }\r\n\r\n  drawSlate() {\r\n    let grad = this.context.createRadialGradient(\r\n    VIEW_W * 0.5, (VIEW_H - RETURN_H) * 0.5, TABLE_H * 0.75 * 0.125,\r\n    VIEW_W * 0.5, (VIEW_H - RETURN_H) * 0.5, TABLE_H * 0.75 * 1.5);\r\n\r\n    grad.addColorStop(0, 'rgba(255,255,255,0.05)');\r\n    grad.addColorStop(0.25, 'rgba(255,255,255,0.05)');\r\n    grad.addColorStop(1, 'rgba(255,255,255,0.15)');\r\n\r\n    this.context.fillStyle = COLORS.felt;\r\n    this.context.fillRect(WALL_RAD, WALL_RAD, TABLE_W + WALL_DI, TABLE_H + WALL_DI);\r\n    this.context.fillStyle = grad;\r\n    this.context.fillRect(WALL_RAD, WALL_RAD, TABLE_W + WALL_DI, TABLE_H + WALL_DI);\r\n  }\r\n\r\n  drawReturn() {\r\n    let gutter = (RETURN_H - BALL_DI * 1.2) * 0.5;\r\n    this.context.fillStyle = COLORS.pocket;\r\n    this.context.fillRect(\r\n    gutter, VIEW_H - RETURN_H + gutter,\r\n    VIEW_W - gutter * 2, RETURN_H - gutter * 2);\r\n\r\n  }\r\n\r\n  drawWall(wallBodies) {\r\n    this.context.fillStyle = COLORS.frame;\r\n    wallBodies.forEach((body, i) => {\r\n      this.context.beginPath();\r\n      body.vertices.forEach(({ x, y }, j) => {\r\n        if (j === 0) {\r\n          this.context.moveTo(x, y);\r\n        } else {\r\n          this.context.lineTo(x, y);\r\n        }\r\n      });\r\n      this.context.fill();\r\n\r\n      // BUMPERS\r\n      this.context.save();\r\n      this.context.beginPath();\r\n      body.vertices.forEach(({ x, y }, j) => {\r\n        if (j === 0) {\r\n          this.context.moveTo(x, y);\r\n        } else {\r\n          this.context.lineTo(x, y);\r\n        }\r\n      });\r\n      this.context.clip();\r\n      this.context.fillStyle = '#787878';\r\n      let clipOff = WALL_DI * 0.75;\r\n      let clipDiff = WALL_DI - clipOff;\r\n      this.context.fillRect(clipOff, clipOff, TABLE_W + clipDiff * 2, TABLE_H + clipDiff * 2);\r\n      this.context.restore();\r\n    });\r\n  }\r\n\r\n  drawPockets(pocketBodies) {\r\n    this.context.fillStyle = COLORS.pocket;\r\n    pocketBodies.forEach(({ position, circleRadius }) => {\r\n      this.context.beginPath();\r\n      this.context.arc(position.x, position.y, circleRadius, 0, PI2, false);\r\n      this.context.fill();\r\n    });\r\n  }\r\n\r\n  drawPoints() {\r\n    let di = 10,\r\n    rad = di * 0.5,\r\n    inc = TABLE_W / 7,\r\n    xc1 = rel(TABLE_W * 0.25),\r\n    xl1 = xc1 - inc,\r\n    xr1 = xc1 + inc,\r\n    xc2 = xc1 + TABLE_W * 0.5,\r\n    xl2 = xc2 - inc,\r\n    xr2 = xc2 + inc,\r\n    x3 = WALL_RAD * 0.75,\r\n    x4 = rel(TABLE_W + WALL_RAD * 1.25),\r\n    y1 = WALL_RAD * 0.75,\r\n    y2 = rel(TABLE_H + WALL_RAD * 1.25),\r\n    yc3 = rel(TABLE_H * 0.5),\r\n    yt3 = yc3 - inc,\r\n    yb3 = yc3 + inc;\r\n    let positions = [\r\n    [xl1, y1], [xc1, y1], [xr1, y1],\r\n    [xl1, y2], [xc1, y2], [xr1, y2],\r\n    [xl2, y1], [xc2, y1], [xr2, y1],\r\n    [xl2, y2], [xc2, y2], [xr2, y2],\r\n    [x3, yt3], [x3, yc3], [x3, yb3],\r\n    [x4, yt3], [x4, yc3], [x4, yb3]];\r\n\r\n    this.context.fillStyle = COLORS.brown;\r\n    positions.forEach(coords => {\r\n      let x = coords[0],\r\n      y = coords[1];\r\n      this.context.beginPath();\r\n      this.context.moveTo(x, y - rad);\r\n      this.context.lineTo(x + rad, y);\r\n      this.context.lineTo(x, y + rad);\r\n      this.context.lineTo(x - rad, y);\r\n      this.context.fill();\r\n    });\r\n  }\r\n\r\n  drawIndicator({ x, y, cueball, power, maxDistance }) {\r\n    this.cueX = cueball.position.x;\r\n    this.cueY = cueball.position.y;\r\n    this.angle = Math.atan2(y - this.cueY, x - this.cueX);\r\n    this.angleCos = Math.cos(this.angle);\r\n    this.angleSin = Math.sin(this.angle);\r\n\r\n    // coordinates for starting power just off the cueball\r\n    let lineMinX = this.cueX + BALL_DI * 1.2 * this.angleCos;\r\n    let lineMinY = this.cueY + BALL_DI * 1.2 * this.angleSin;\r\n\r\n    // coordinates for showing power\r\n    let lineMaxX = lineMinX + maxDistance * this.angleCos;\r\n    let lineMaxY = lineMinY + maxDistance * this.angleSin;\r\n\r\n    // coordinates for calculating power\r\n    let newX = lineMinX + power * maxDistance * this.angleCos;\r\n    let newY = lineMinY + power * maxDistance * this.angleSin;\r\n\r\n    // setting the force relative to power\r\n    this.forceX = (newX - lineMinX) / maxDistance * 0.02;\r\n    this.forceY = (newY - lineMinY) / maxDistance * 0.02;\r\n\r\n    this.context.lineCap = 'round';\r\n\r\n    // max power\r\n    this.context.strokeStyle = 'rgba(255, 255, 255, 0.1)';\r\n    this.context.lineWidth = 4;\r\n    this.context.beginPath();\r\n    this.context.moveTo(lineMinX, lineMinY);\r\n    this.context.lineTo(lineMaxX, lineMaxY);\r\n    this.context.stroke();\r\n    this.context.closePath();\r\n\r\n    // power level\r\n    this.context.strokeStyle = 'rgba(255, 255, 255, 0.9)';\r\n    this.context.lineWidth = 4;\r\n    this.context.beginPath();\r\n    this.context.moveTo(lineMinX, lineMinY);\r\n    this.context.lineTo(newX, newY);\r\n    this.context.stroke();\r\n    this.context.closePath();\r\n  }\r\n\r\n  drawBalls({ balls, ballIds }) {\r\n    let inAngle = [];\r\n    for (let i = 0, len = ballIds.length; i < len; i++) {\r\n      let ballId = ballIds[i];\r\n      let ball = balls[ballId];\r\n      this.drawBall(ball);\r\n    }\r\n  }\r\n\r\n  drawBall(ball) {\r\n    let x = ball.body.position.x,\r\n    y = ball.body.position.y,\r\n    rad = ball.body.circleRadius,\r\n    di = rad * 2,\r\n    a = ball.body.angle;\r\n\r\n    this.context.translate(x, y);\r\n    this.context.rotate(a);\r\n\r\n    // offset from center\r\n    let offsetX = (x - WALL_DI) / TABLE_W * 2 - 1,\r\n    offsetY = (y - WALL_DI) / TABLE_H * 2 - 1;\r\n\r\n    let grad = this.context.createRadialGradient(\r\n    rad * offsetX, rad * offsetY, rad * 0.125,\r\n    rad * offsetX, rad * offsetY, rad * 1.5);\r\n\r\n    if (ball.eight) {\r\n      grad.addColorStop(0, 'rgba(255,255,255,0.15)');\r\n      grad.addColorStop(1, 'rgba(255,255,255,0.05)');\r\n    } else {\r\n      grad.addColorStop(0, 'rgba(0,0,0,0.05)');\r\n      grad.addColorStop(1, 'rgba(0,0,0,0.3)');\r\n    }\r\n\r\n    this.context.shadowColor = 'rgba(0,0,0,0.05)';\r\n    this.context.shadowBlur = 2;\r\n    this.context.shadowOffsetX = -offsetX * BALL_RAD * 0.5;\r\n    this.context.shadowOffsetY = -offsetY * BALL_RAD * 0.5;\r\n\r\n    this.context.fillStyle = ball.color;\r\n    this.context.beginPath();\r\n    this.context.arc(0, 0, rad, 0, PI2, false);\r\n    this.context.fill();\r\n    this.context.shadowColor = 'transparent';\r\n\r\n    if (ball.stripes) {\r\n      let s1 = PI * 0.15,\r\n      e1 = PI - s1,\r\n      s2 = PI * -0.15,\r\n      e2 = PI - s2;\r\n      this.context.fillStyle = 'white';\r\n      this.context.beginPath();\r\n      this.context.arc(0, 0, rad, s1, e1, false);\r\n      this.context.fill();\r\n      this.context.beginPath();\r\n      this.context.arc(0, 0, rad, s2, e2, true);\r\n      this.context.fill();\r\n    }\r\n\r\n    this.context.rotate(-a);\r\n\r\n    this.context.beginPath();\r\n    this.context.arc(0, 0, rad, 0, PI2, false);\r\n    this.context.fillStyle = grad;\r\n    this.context.fill();\r\n\r\n    this.context.translate(-x, -y);\r\n  }}\r\n\r\n\r\nclass Game {\r\n  constructor({ world, canvas, sounds }) {\r\n    this.machine = new Machine();\r\n    this.sounds = sounds;\r\n    this.world = world;\r\n    this.canvas = canvas;\r\n    this.$score = document.querySelector('div.score');\r\n    this.$message = document.querySelector('div.message');\r\n    this.table = new Table();\r\n    this.balls = {};\r\n    this.ballIds = [];\r\n    this.ballNumbers.forEach(number => {\r\n      let ball = new Ball({ number, cueball: this.cueball });\r\n      if (ball.cue) this.cueId = ball.body.id;\r\n      if (ball.eight) this.eightId = ball.body.id;\r\n      this.balls[ball.body.id] = ball;\r\n      this.ballIds.push(ball.body.id);\r\n    });\r\n    this.addBodiesToWorld();\r\n    initEscapedBodiesRetrieval(this.ballIds.map(id => this.balls[id].body));\r\n    this.reset();\r\n  }\r\n\r\n  handleEscapedBall(ballId) {\r\n    console.log('ESCAPED', this.balls[ballId]);\r\n    this.balls[ballId].reset();\r\n  }\r\n\r\n  reset() {\r\n    this.gameOver = false;\r\n    this.break = true;\r\n    this.mousedown = false;\r\n    this.power = 0;\r\n    this.powerStep = 0.015;\r\n    this.powerDirection = 1;\r\n    this.players = [new Player(1), new Player(2)];\r\n    this.playersAssigned = false;\r\n    this.currentPlayerIdx = 0;\r\n\r\n    this.messages = [this.currentPlayer.turnText];\r\n\r\n    this.pocketedThisTurn = [];\r\n    this.pocketedStripes = 0;\r\n    this.pocketedSolids = 0;\r\n    this.placingCueball = true;\r\n    this.ballIds.forEach(ballId => this.balls[ballId].reset());\r\n    this.updateDOM();\r\n  }\r\n\r\n  get currentPlayer() {\r\n    return this.players[this.currentPlayerIdx % 2];\r\n  }\r\n\r\n  get otherPlayer() {\r\n    return this.players[(this.currentPlayerIdx + 1) % 2];\r\n  }\r\n\r\n  get isMachine() {\r\n    return this.currentPlayerIdx % 2 !== 0;\r\n  }\r\n\r\n  addBodiesToWorld() {\r\n    World.add(this.world, this.table.bounds);\r\n    World.add(this.world, this.table.walls);\r\n    World.add(this.world, this.table.pockets);\r\n    World.add(this.world, this.ballIds.map(b => this.balls[b].body));\r\n  }\r\n\r\n  handleMousedown() {\r\n    if (this.gameOver) return;\r\n    if (this.moving) return;\r\n    if (!this.placingCueball)\r\n    this.mousedown = true;\r\n  }\r\n\r\n  handleMouseup() {\r\n    if (this.gameOver) return;\r\n    this.mousedown = false;\r\n    if (this.moving) return;\r\n    if (this.placingCueball)\r\n    this.placeCueball();else\r\n\r\n    this.strikeCueball();\r\n  }\r\n\r\n  handlePocketed(ballId) {\r\n    let ball = this.balls[ballId];\r\n    if (ball.cue) this.setupCueball();\r\n    this.handlePocketedBall(ball);\r\n  }\r\n\r\n  handlePocketedBall(ball) {\r\n    this.pocketedThisTurn.push(ball);\r\n    let x,\r\n    y = VIEW_H - RETURN_H / 2;\r\n    if (ball.stripes) {\r\n      x = VIEW_W - this.pocketedStripes * (BALL_DI * 1.2) - RETURN_H * 0.5;\r\n      this.pocketedStripes++;\r\n    } else if (ball.solids) {\r\n      x = this.pocketedSolids * (BALL_DI * 1.2) + RETURN_H * 0.5;\r\n      this.pocketedSolids++;\r\n    } else if (ball.cue) {\r\n      x = VIEW_W * 0.5 + BALL_RAD * 1.1;\r\n    } else {// ball.eight\r\n      x = VIEW_W * 0.5 - BALL_RAD * 1.1;\r\n    }\r\n\r\n    ball.pocket({ x, y });\r\n  }\r\n\r\n  handleTickAfter({ x, y }) {\r\n    this.tickPower();\r\n    let power = this.power;\r\n    let wasMoving = this.moving;\r\n    this.checkMovement();\r\n    let isMoving = this.moving;\r\n    if (wasMoving && !isMoving) this.handleTurnEnd();\r\n\r\n    let movingCrosshair = { x, y };\r\n\r\n    this.canvas.drawTable({ wallBodies: this.table.walls, pocketBodies: this.table.pockets });\r\n    this.canvas.drawBalls({ balls: this.balls, ballIds: this.ballIds });\r\n\r\n    let isMachineClick = this.isMachine && this.machine.fire();\r\n    if (this.isMachine) {\r\n      this.machine.tick();\r\n      x = this.machine.x;y = this.machine.y;\r\n      power = this.machine.power;\r\n    }\r\n\r\n    if (isMachineClick) this.handleMousedown();\r\n    if (this.placingCueball) {\r\n      this.moveCueball(x, y);\r\n    } else if (!this.moving && !this.gameOver) {\r\n      this.canvas.drawIndicator({\r\n        x, y, power,\r\n        cueball: this.cueball.body,\r\n        maxDistance: this.table.height * 0.5 });\r\n\r\n    }\r\n    if (isMachineClick) this.handleMouseup();\r\n    if (isMoving || this.isMachine) this.canvas.drawMovingCrosshair(movingCrosshair);\r\n    if (!isMoving) this.canvas.drawCrosshair({ x, y });\r\n  }\r\n\r\n  handleCollisionActive({ pairs }) {\r\n    pairs.forEach(({ bodyA, bodyB }, i) => {\r\n      let coll = bodyA.label + bodyB.label;\r\n      if (coll === 'ballpocket' || coll == 'pocketball') {\r\n        let ball = bodyA.label === 'ball' ? bodyA : bodyB;\r\n        let distance = Math.hypot(\r\n        bodyA.position.y - bodyB.position.y,\r\n        bodyA.position.x - bodyB.position.x);\r\n\r\n        if (distance / BALL_DI <= 1)\r\n        this.handlePocketed(ball.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  handleCollisionStart({ pairs }) {\r\n    if (this.placingCueball) return;\r\n    pairs.forEach((collision, i) => {\r\n      let { bodyA, bodyB } = collision;\r\n      let speed = collision.collision.axisBody.speed;\r\n      let coll = bodyA.label + bodyB.label;\r\n      if (!this.firstContact && coll === 'ballball')\r\n      this.firstContact = [bodyA, bodyB];\r\n      if (coll === 'ballball') {\r\n        let vol = Math.min(0.5, speed) + 0.05;\r\n        let rate = Math.random() - 0.5 + 1;\r\n        this.sounds.ball.rate(rate);\r\n        this.sounds.ball.volume(vol);\r\n        this.sounds.ball.play();\r\n      } else if (coll === 'ballwall' || coll === 'wallball') {\r\n        let vol = Math.min(1, speed) * 0.8 + 0.2;\r\n        let rate = Math.random() - 0.5 + 0.75;\r\n        this.sounds.rail.rate(rate);\r\n        this.sounds.rail.volume(vol);\r\n        this.sounds.rail.play();\r\n      }\r\n    });\r\n  }\r\n\r\n  // logic for valid first contact, scoring, and game end.\r\n  handleTurnEnd() {\r\n    this.restBalls();\r\n    this.messages = [];\r\n    this.power = 0;\r\n    let pocketed = this.pocketedThisTurn;\r\n    let winner = null;\r\n\r\n    let isCue = pocketed.filter(b => b.cue).length > 0,\r\n    isEight = pocketed.filter(b => b.eight).length > 0;\r\n\r\n    // determining valid first contact\r\n    let validFirstContact = true;\r\n    if (this.firstContact) {\r\n      let balls = this.firstContact.map(b => this.balls[b.id]);\r\n      let ball = balls.filter(b => !b.cue)[0];\r\n      if (this.playersAssigned && !isCue && !isEight)\r\n      if (\r\n      this.currentPlayer.stripes && !ball.stripes ||\r\n      this.currentPlayer.solids && !ball.solids)\r\n      validFirstContact = false;\r\n      this.firstContact = null;\r\n    }\r\n\r\n    // handling pocketed balls\r\n    if (pocketed.length > 0) {\r\n      let stripes = pocketed.filter(b => b.stripes),\r\n      solids = pocketed.filter(b => b.solids),\r\n      hasStripes = stripes.length > 0,\r\n      hasSolids = solids.length > 0;\r\n\r\n      // assigning players\r\n      if (!this.playersAssigned) {\r\n        // only assign if one kind of ball went in and cueball and eightball were not pocketed\r\n        if ((!hasStripes || !hasSolids) && !isCue && !isEight) {\r\n          this.currentPlayer.assign(hasStripes);\r\n          this.otherPlayer.assign(!hasStripes);\r\n          this.playersAssigned = true;\r\n        }\r\n      }\r\n\r\n      // calculate scores\r\n      if (this.currentPlayer.stripes) {\r\n        this.currentPlayer.score(stripes.length);\r\n        this.otherPlayer.score(solids.length);\r\n      } else if (this.currentPlayer.solids) {\r\n        this.currentPlayer.score(solids.length);\r\n        this.otherPlayer.score(stripes.length);\r\n      }\r\n\r\n      // handling game over\r\n      if (isEight) {\r\n        this.messageEight();\r\n        winner = this.currentPlayer.onEight ? this.currentPlayer : this.otherPlayer;\r\n        // handling cueball\r\n      } else if (isCue) {\r\n        this.messageScratch();\r\n        this.switchTurns();\r\n        // handling invalid contact\r\n      } else if (!validFirstContact) {\r\n        this.messageInvalidContact();\r\n        this.switchTurns();\r\n        // handling the wrong ball\r\n      } else if (\r\n      !hasStripes && this.currentPlayer.stripes ||\r\n      !hasSolids && this.currentPlayer.solids)\r\n      {\r\n        this.switchTurns();\r\n      }\r\n      // scratching with no other pocketed balls\r\n    } else if (isCue) {\r\n      this.messageScratch();\r\n      this.switchTurns();\r\n      // switching turns on nothing going in\r\n    } else {\r\n      this.switchTurns();\r\n    }\r\n    // ending the turn\r\n    this.pocketedThisTurn = [];\r\n    if (winner) {\r\n      this.messageWin(winner);\r\n      this.handleGameOver();\r\n    } else {\r\n      this.messageTurn();\r\n    }\r\n    if (this.isMachine) {\r\n      let aMachineBall = this.aMachineBall;\r\n      this.machine.reset(aMachineBall.body.position, this.placingCueball);\r\n    }\r\n    this.updateDOM();\r\n  }\r\n\r\n  handleGameOver() {\r\n    this.gameOver = true;\r\n    let $button = document.createElement('button');\r\n    $button.innerHTML = 'New Game';\r\n    $button.addEventListener('click', () => {\r\n      $button.remove();\r\n      this.reset();\r\n    });\r\n    document.body.appendChild($button);\r\n  }\r\n\r\n  messageTurn() {\r\n    this.messages.push(this.currentPlayer.turnText);\r\n  }\r\n\r\n  messageScratch() {\r\n    this.messages.push(this.currentPlayer.scratchText);\r\n  }\r\n\r\n  messageInvalidContact() {\r\n    this.messages.push(this.currentPlayer.invalidContactText);\r\n  }\r\n\r\n  messageEight() {\r\n    this.messages.push(this.currentPlayer.eightText);\r\n  }\r\n\r\n  messageWin(winner) {\r\n    this.messages.push(winner.winText);\r\n  }\r\n\r\n  restBalls() {\r\n    this.ballIds.forEach(id => this.balls[id].rest());\r\n  }\r\n\r\n  strikeCueball() {\r\n    this.break = false;\r\n    this.moving = true;\r\n    let power = this.isMachine ? this.machine.power : this.power;\r\n    let vol = Math.min(1, power) * 0.9 + 0.1;\r\n    this.sounds.cue.volume(vol);\r\n    this.sounds.cue.play();\r\n    Body.applyForce(\r\n    this.cueball.body,\r\n    this.cueball.body.position,\r\n    { x: this.canvas.forceX, y: this.canvas.forceY });\r\n\r\n  }\r\n\r\n  setupCueball() {\r\n    this.cueball.disable();\r\n    this.placingCueball = true;\r\n  }\r\n\r\n  placeCueball() {\r\n    this.cueball.enable();\r\n    this.cueball.pocketed = false;\r\n    this.placingCueball = false;\r\n  }\r\n\r\n  moveCueball(x, y) {\r\n    if (this.moving) {\r\n      x = rel(TABLE_W / 2);\r\n      y = rel(TABLE_H + WALL_DI + RETURN_H * 0.5);\r\n    } else {\r\n      let maxX = this.break ? rel(TABLE_W / 4 - BALL_RAD) : rel(TABLE_W - BALL_RAD),\r\n      minX = rel(0 + BALL_RAD),\r\n      maxY = rel(TABLE_H - BALL_RAD),\r\n      minY = rel(0 + BALL_RAD);\r\n      x = Math.min(maxX, Math.max(minX, x));\r\n      y = Math.min(maxY, Math.max(minY, y));\r\n    }\r\n    this.cueball.setVelocity({ x: 0, y: 0 });\r\n    Body.setPosition(this.cueball.body, { x, y });\r\n  }\r\n\r\n  tickPower() {\r\n    if (this.mousedown) {\r\n      this.power += this.powerStep * this.powerDirection;\r\n      if (this.power < 0) {\r\n        this.powerDirection = 1;\r\n        this.power = 0;\r\n      } else if (this.power > 1) {\r\n        this.powerDirection = -1;\r\n        this.power = 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDOM() {\r\n    let current = this.currentPlayerIdx % 2;\r\n    this.$score.innerHTML =\r\n    this.updatePlayerDOM(this.players[0], current === 0) +\r\n    this.updatePlayerDOM(this.players[1], current === 1);\r\n    this.$message.innerHTML = '<p>' + this.messages.map(m => m).join(' ') + '</p>';\r\n  }\r\n\r\n  updatePlayerDOM(player, current) {\r\n    return `<span>\r\n  <span>${player.nameText}</span>\r\n  <span>${player.points}</span>\r\n</span>`;\r\n  }\r\n\r\n  switchTurns() {\r\n    this.currentPlayerIdx++;\r\n  }\r\n\r\n  checkMovement() {\r\n    if (this.moving) {\r\n      let moving = false;\r\n      for (let i = 0, len = this.ballIds.length; i < len && !moving; i++) {\r\n        let ballId = this.ballIds[i];\r\n        let ball = this.balls[ballId];\r\n        if (ball.body && ball.body.speed > 0.125) moving = true;\r\n      }\r\n      this.moving = moving;\r\n    }\r\n  }\r\n\r\n  get aMachineBall() {\r\n    let balls = this.ballIds.map(id => this.balls[id]).filter(b => !b.pocketed);\r\n    if (this.players[1].onEight) {\r\n      balls = [this.eightball];\r\n    } else if (this.players[1].stripes) {\r\n      balls = balls.filter(b => b.stripes);\r\n    } else if (this.players[1].solids) {\r\n      balls = balls.filter(b => b.solids);\r\n    } else {\r\n      balls = balls.filter(b => !b.cue && !b.eight);\r\n    }\r\n    return balls[Math.floor(Math.random() * balls.length)];\r\n  }\r\n\r\n  get cueball() {\r\n    return this.balls[this.cueId];\r\n  }\r\n\r\n  get eightball() {\r\n    return this.balls[this.eightId];\r\n  }\r\n\r\n  get ballNumbers() {\r\n    return [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];\r\n  }}\r\n\r\n\r\n// create a world and engine\r\nlet world = World.create({ gravity: { x: 0, y: 0 } });\r\nlet engine = Engine.create({ world, timing: { timeScale: 1 } });\r\n\r\n// create a renderer\r\nlet element = document.querySelector('div.canvas');\r\nlet render = Render.create({\r\n  element, engine,\r\n  options: {\r\n    width: VIEW_W,\r\n    height: VIEW_H,\r\n    wireframes: WIREFRAMES,\r\n    background: COLORS.frame } });\r\n\r\n\r\n\r\nif (window.location.href.match(/cpgrid/)) {\r\n  document.body.classList.add('screenshot');\r\n  let src = 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/111863/billiards.png';\r\n  let img = new Image();\r\n  img.src = src;\r\n  document.body.appendChild(img);\r\n} else {\r\n  let canvas = new Canvas(render);\r\n  let mouse = Mouse.create(render.canvas);\r\n  let sounds = {\r\n    cue: new Howl({ src: [ASSET_PREFIX + 'billiards-cue.mp3', ASSET_PREFIX + 'billiards-cue.ogg'] }),\r\n    ball: new Howl({ src: [ASSET_PREFIX + 'billiards-ball.mp3', ASSET_PREFIX + 'billiards-ball.ogg'] }),\r\n    rail: new Howl({ src: [ASSET_PREFIX + 'billiards-rail.mp3', ASSET_PREFIX + 'billiards-rail.ogg'] }) };\r\n\r\n  let game = new Game({ world, canvas, sounds });\r\n\r\n  Events.on(render, 'afterRender', () => {\r\n    game.handleTickAfter({ x: mouse.position.x, y: mouse.position.y });\r\n  });\r\n\r\n  let constraint = MouseConstraint.create(engine, { mouse });\r\n  Events.on(constraint, 'mousedown', ({ mouse }) => {\r\n    game.handleMousedown();\r\n  });\r\n  Events.on(constraint, 'mouseup', ({ mouse }) => {\r\n    game.handleMouseup();\r\n  });\r\n\r\n  Events.on(engine, 'collisionActive', e => {\r\n    game.handleCollisionActive({ pairs: e.pairs });\r\n  });\r\n\r\n  Events.on(engine, 'collisionStart', e => {\r\n    game.handleCollisionStart({ pairs: e.pairs });\r\n  });\r\n\r\n  // run the engine\r\n  Engine.run(engine);\r\n\r\n  // run the renderer\r\n  Render.run(render);\r\n}\r\n\r\n\r\nfunction rel(x) {\r\n  return x + WALL_DI;\r\n}\r\n\r\nfunction initEscapedBodiesRetrieval(allBodies) {\r\n  function hasBodyEscaped(body) {\r\n    let { x, y } = body.position;\r\n    return x < 0 || x > VIEW_W || y < 0 || y > VIEW_H;\r\n  }\r\n\r\n  setInterval(() => {\r\n    let i, body;\r\n    for (i = 0; i < allBodies.length; i++) {\r\n      body = allBodies[i];\r\n      if (hasBodyEscaped(body)) game.handleEscapedBall(body.id);\r\n    }\r\n  }, 300);\r\n}\r\n//# sourceURL=pen.js"],"file":"main.dev.js"}